<%- include('layout') %>

<!-- Navbar -->
<nav class="navbar">
    <a href="/" class="navbar-brand">
        <div class="navbar-logo">ITC</div>
        <span>Bot Dashboard</span>
    </a>
    <button class="hamburger" id="hamburgerBtn" aria-label="Menu">
        <span></span><span></span><span></span>
    </button>
    <div class="navbar-right navbar-links" id="navLinks">
        <span class="badge badge-<%= user.role %>"><%= user.role.toUpperCase() %></span>
        <div style="display:flex; align-items:center; gap:8px;">
            <img src="<%= user.avatarUrl %>" alt="" style="width:28px; height:28px; border-radius:50%;" />
            <span style="color: var(--text-secondary); font-size: 0.85rem;" class="hide-mobile"><%= user.globalName || user.username %></span>
        </div>
        <a href="/logout" class="btn btn-outline btn-sm">Logout</a>
    </div>
</nav>

<div class="container" style="max-width:1400px;">
    <div class="page-header">
        <h1 class="page-title"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-4px;margin-right:6px;"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>Developer Panel</h1>
        <a href="/" class="btn btn-outline btn-sm">← Dashboard</a>
    </div>

    <!-- Tabs -->
    <div class="dev-tabs">
        <button class="dev-tab active" data-tab="console">Console Logs</button>
        <button class="dev-tab" data-tab="online">Users</button>
        <button class="dev-tab" data-tab="login">Login Log</button>
        <% if (user.role === 'dev') { %>
        <button class="dev-tab" data-tab="bots">Bot Control</button>
        <% } %>
    </div>

    <!-- ═══ Console Logs Tab ════════════════════════════════════════ -->
    <div class="dev-tab-content active" id="tab-console">
        <div class="card" style="display:flex; align-items:center; gap:12px; flex-wrap:wrap; padding:12px 16px;">
            <span style="color:var(--text-secondary); font-size:0.85rem; font-weight:600;">Filter:</span>
            <button class="log-filter-btn active" data-level="all">All</button>
            <button class="log-filter-btn" data-level="error" style="--filter-color: var(--danger);">Error</button>
            <button class="log-filter-btn" data-level="success" style="--filter-color: var(--success);">Success</button>
            <button class="log-filter-btn" data-level="database" style="--filter-color: var(--accent);">Database</button>
            <button class="log-filter-btn" data-level="debug" style="--filter-color: var(--text-secondary);">Debug</button>
            <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
                <label class="toggle-wrapper" style="gap:8px;">
                    <label class="toggle" style="width:40px; height:22px;">
                        <input type="checkbox" id="autoRefresh" checked />
                        <span class="toggle-slider" style="border-radius:22px;"></span>
                    </label>
                    <span style="color:var(--text-secondary); font-size:0.82rem;">Live</span>
                </label>
                <button class="btn btn-outline btn-sm" id="clearBtn">Clear</button>
            </div>
        </div>
        <div class="card" style="padding:0; overflow:hidden;">
            <div id="logContainer" style="
                max-height: calc(100vh - 340px);
                overflow-y: auto;
                font-family: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;
                font-size: 0.82rem;
                line-height: 1.6;
            ">
                <div id="logEmpty" style="text-align:center; padding:40px; color:var(--text-secondary);">
                    Waiting for logs...
                </div>
            </div>
        </div>
    </div>

    <!-- ═══ Online Users Tab ════════════════════════════════════════ -->
    <div class="dev-tab-content" id="tab-online">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Users</h3>
                <span id="onlineCount" class="badge badge-dev" style="font-size:0.85rem;">0 online</span>
            </div>
            <div class="toolbar" style="margin-top:10px;">
                <input type="text" id="devUserSearch" placeholder="Search by username or ID..." style="width:100%;" />
            </div>
            <div id="onlineUsersList">
                <div class="empty-state" style="padding:30px;">
                    <p>Loading users...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══ Login Log Tab ══════════════════════════════════════════ -->
    <div class="dev-tab-content" id="tab-login">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Login Activity</h3>
                <button class="btn btn-outline btn-sm" id="refreshLoginLog">Refresh</button>
            </div>
            <div id="loginLogList">
                <div class="empty-state" style="padding:30px;">
                    <p>Loading login history...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══ Bot Control Tab ════════════════════════════════════════ -->
    <div class="dev-tab-content" id="tab-bots">
        <div class="card-grid" id="botControlGrid">
            <% bots.forEach(function(bot) { %>
            <div class="card" data-team="<%= bot.teamName %>">
                <div class="card-header">
                    <h3 class="card-title"><%= bot.teamName %></h3>
                    <span class="status-dot status-<%= bot.isActive ? 'active' : 'inactive' %>" id="status-<%= bot._id %>"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Status</span>
                    <span class="info-value" id="statusText-<%= bot._id %>"><%= bot.isActive ? 'Active' : 'Inactive' %></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Split Mode</span>
                    <span class="info-value"><%= bot.isSplit ? 'Yes' : 'No' %></span>
                </div>
                <div style="display:flex; gap:8px; margin-top:14px; flex-wrap:wrap;">
                    <button class="btn btn-sm <%= bot.isActive ? 'btn-danger' : 'btn-success' %> bot-toggle-btn"
                            data-id="<%= bot._id %>" data-active="<%= bot.isActive %>">
                        <%= bot.isActive ? 'Deactivate' : 'Activate' %>
                    </button>
                    <button class="btn btn-outline btn-sm bot-reconnect-btn" data-id="<%= bot._id %>"
                            data-team="<%= bot.teamName %>" data-split="<%= bot.isSplit %>">
                        Reconnect
                    </button>
                    <button class="btn btn-outline btn-sm bot-disconnect-btn" data-id="<%= bot._id %>"
                            data-team="<%= bot.teamName %>" data-split="<%= bot.isSplit %>">
                        Disconnect
                    </button>
                </div>
            </div>
            <% }); %>
        </div>
    </div>
</div>

<style>
    .log-filter-btn {
        padding: 4px 14px;
        border: 1px solid var(--border);
        border-radius: 20px;
        background: transparent;
        color: var(--text-secondary);
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }
    .log-filter-btn:hover { border-color: var(--accent); color: var(--accent); }
    .log-filter-btn.active {
        background: var(--filter-color, var(--accent));
        color: #fff;
        border-color: var(--filter-color, var(--accent));
    }
    .log-entry {
        display: grid;
        grid-template-columns: 80px 70px 1fr;
        gap: 12px;
        padding: 6px 16px;
        border-bottom: 1px solid rgba(255,255,255,0.03);
        align-items: start;
    }
    .log-entry:hover { background: rgba(255,255,255,0.02); }
    .log-time { color: var(--text-secondary); font-size: 0.78rem; white-space: nowrap; }
    .log-level {
        font-size: 0.72rem; font-weight: 700; text-transform: uppercase;
        padding: 2px 8px; border-radius: 4px; text-align: center; white-space: nowrap;
    }
    .log-level-error { background: #f8717130; color: var(--danger); }
    .log-level-success { background: #4ade8025; color: var(--success); }
    .log-level-database { background: rgba(230,57,70,0.12); color: var(--accent); }
    .log-level-debug { background: rgba(255,255,255,0.05); color: var(--text-secondary); }
    .log-body { color: var(--text-primary); word-break: break-word; }
    .log-body .log-title { font-weight: 600; }
    .log-body .log-detail { color: var(--text-secondary); margin-left: 8px; }
</style>

<script src="/socket.io/socket.io.js"></script>
<script>
(function() {
    // ─── Tab switching ───────────────────────────────────────────
    var tabs = document.querySelectorAll('.dev-tab');
    var contents = document.querySelectorAll('.dev-tab-content');
    tabs.forEach(function(tab) {
        tab.addEventListener('click', function() {
            tabs.forEach(function(t) { t.classList.remove('active'); });
            contents.forEach(function(c) { c.classList.remove('active'); });
            tab.classList.add('active');
            document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
        });
    });

    // ─── Socket connection ───────────────────────────────────────
    var socket = io();
    socket.on('connect', function() {
        socket.emit('join:console');
        socket.emit('join:dev');
    });

    // ─── Console Logs ────────────────────────────────────────────
    var container = document.getElementById('logContainer');
    var emptyEl = document.getElementById('logEmpty');
    var filterBtns = document.querySelectorAll('.log-filter-btn');
    var autoRefreshCb = document.getElementById('autoRefresh');
    var clearBtn = document.getElementById('clearBtn');
    var currentLevel = 'all';
    var lastTimestamp = 0;

    socket.on('log:new', function(log) {
        if (currentLevel !== 'all' && log.level !== currentLevel) return;
        if (log.timestamp <= lastTimestamp) return;
        if (emptyEl && emptyEl.parentNode === container) container.removeChild(emptyEl);
        var wasAtBottom = container.scrollTop + container.clientHeight >= container.scrollHeight - 20;
        container.appendChild(createLogEntry(log));
        lastTimestamp = log.timestamp;
        if (wasAtBottom) container.scrollTop = container.scrollHeight;
    });

    filterBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
            filterBtns.forEach(function(b) { b.classList.remove('active'); });
            btn.classList.add('active');
            currentLevel = btn.dataset.level;
            lastTimestamp = 0;
            container.innerHTML = '';
            fetchLogs();
        });
    });

    clearBtn.addEventListener('click', function() {
        container.innerHTML = '';
        if (emptyEl) container.appendChild(emptyEl);
    });

    function formatTime(ts) {
        var d = new Date(ts);
        return d.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    }

    function createLogEntry(log) {
        var div = document.createElement('div');
        div.className = 'log-entry';
        div.innerHTML =
            '<span class="log-time">' + formatTime(log.timestamp) + '</span>' +
            '<span class="log-level log-level-' + log.level + '">' + log.level + '</span>' +
            '<span class="log-body"><span class="log-title">' + escapeHtml(log.title) + '</span>' +
            (log.body ? '<span class="log-detail">' + escapeHtml(log.body) + '</span>' : '') +
            '</span>';
        return div;
    }

    function escapeHtml(s) {
        var div = document.createElement('div');
        div.textContent = s;
        return div.innerHTML;
    }

    async function fetchLogs() {
        try {
            var url = '/api/logs?limit=200&level=' + currentLevel;
            var res = await fetch(url);
            if (!res.ok) return;
            var logs = await res.json();
            if (!logs.length) return;
            if (emptyEl && emptyEl.parentNode === container) container.removeChild(emptyEl);
            logs.forEach(function(log) { container.appendChild(createLogEntry(log)); });
            lastTimestamp = Math.max.apply(null, logs.map(function(l) { return l.timestamp; }));
            container.scrollTop = container.scrollHeight;
        } catch(e) { /* silent */ }
    }

    autoRefreshCb.addEventListener('change', function() {
        if (autoRefreshCb.checked) {
            if (!socket.connected) socket.connect();
        }
    });

    fetchLogs();

    // ─── All Users (online/offline) ─────────────────────────────
    var onlineList = document.getElementById('onlineUsersList');
    var onlineCount = document.getElementById('onlineCount');
    var devAllUsers = [];

    document.getElementById('devUserSearch').addEventListener('input', function() { renderAllUsers(devAllUsers); });

    async function fetchAllUsers() {
        try {
            var res = await fetch('/api/dev/all-users');
            if (!res.ok) return;
            devAllUsers = await res.json();
            renderAllUsers(devAllUsers);
        } catch(e) { /* silent */ }
    }

    function renderAllUsers(users) {
        if (!users || !users.length) {
            onlineList.innerHTML = '<div class="empty-state" style="padding:30px;"><p>No registered users</p></div>';
            onlineCount.textContent = '0 online';
            return;
        }

        var onCount = users.filter(function(u) { return u.isOnline; }).length;
        onlineCount.textContent = onCount + '/' + users.length + ' online';

        var q = document.getElementById('devUserSearch').value.toLowerCase().trim();
        var filtered = users;
        if (q) {
            filtered = users.filter(function(u) {
                return u.username.toLowerCase().indexOf(q) !== -1 ||
                    (u.globalName || '').toLowerCase().indexOf(q) !== -1 ||
                    u.discordId.indexOf(q) !== -1;
            });
        }
        if (filtered.length === 0) {
            onlineList.innerHTML = '<div class="empty-state" style="padding:30px;"><p>No users match "' + escapeHtml(q) + '"</p></div>';
            return;
        }

        var html = '';
        filtered.forEach(function(u) {
            var dotColor = u.isOnline ? 'var(--success)' : 'var(--danger)';
            var dotShadow = u.isOnline ? 'box-shadow:0 0 6px var(--success);' : '';
            var opacity = u.isOnline ? '1' : '0.6';
            var pageInfo = u.isOnline && u.currentPage ? ' &middot; ' + escapeHtml(u.currentPage) : '';
            var lastSeenStr = '';
            if (!u.isOnline && u.lastSeen) {
                var d = new Date(u.lastSeen);
                lastSeenStr = ' &middot; Last seen ' + d.toLocaleDateString('en-GB') + ' ' + d.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
            }
            var wlBadge = u.isWhitelisted ? ' <span style="font-size:0.65rem;padding:1px 6px;border-radius:6px;background:rgba(230,57,70,0.15);color:var(--accent);border:1px solid rgba(230,57,70,0.3);">WL</span>' : '';

            html += '<div class="online-user" style="opacity:' + opacity + ';" data-ctx="dev-user"' +
                ' data-discord-id="' + escapeHtml(u.discordId) + '"' +
                ' data-username="' + escapeHtml(u.globalName || u.username) + '"' +
                ' data-role="' + escapeHtml(u.role) + '"' +
                ' data-online="' + (u.isOnline ? '1' : '0') + '"' +
                ' data-whitelisted="' + (u.isWhitelisted ? '1' : '0') + '">' +
                '<div style="position:relative; flex-shrink:0;">' +
                    '<img src="' + (u.avatarUrl || '') + '" alt="" style="width:32px;height:32px;border-radius:50%;" />' +
                    '<span style="position:absolute;bottom:0;right:0;width:10px;height:10px;border-radius:50%;background:' + dotColor + ';' + dotShadow + 'border:2px solid var(--bg-primary);"></span>' +
                '</div>' +
                '<div style="flex:1;">' +
                    '<div style="font-weight:600; font-size:0.9rem;">' + escapeHtml(u.globalName || u.username) + wlBadge + '</div>' +
                    '<div style="font-size:0.78rem; color:var(--text-secondary);">' +
                        '<span class="badge badge-' + u.role + '" style="font-size:0.7rem; padding:2px 8px;">' + u.role.toUpperCase() + '</span>' +
                        (u.isOnline ? '<span style="margin-left:4px;display:inline-flex;align-items:center;gap:3px;"><span class="dot-icon dot-green" style="width:7px;height:7px;"></span><span style="color:var(--success);">online</span></span>' : '<span style="margin-left:4px;display:inline-flex;align-items:center;gap:3px;"><span class="dot-icon dot-red" style="width:7px;height:7px;"></span><span style="color:var(--danger);">offline</span></span>') +
                        pageInfo + lastSeenStr +
                    '</div>' +
                '</div>' +
            '</div>';
        });
        onlineList.innerHTML = html;
    }

    socket.on('dev:online-users', function() { fetchAllUsers(); });
    socket.on('dev:user-online', function() { fetchAllUsers(); });
    socket.on('dev:user-offline', function() { fetchAllUsers(); });

    // Initial fetch
    fetchAllUsers();

    var IS_DEV_OWNER = '<%= user.role %>' === 'dev';

    // ─── User right-click context menu ───────────────────────────
    document.getElementById('onlineUsersList').addEventListener('contextmenu', function(e) {
        var userEl = e.target.closest('[data-ctx="dev-user"]');
        if (!userEl) return;
        e.preventDefault();
        e.stopPropagation();

        var discordId = userEl.dataset.discordId;
        var username = userEl.dataset.username;
        var role = userEl.dataset.role;
        var isOnline = userEl.dataset.online === '1';
        var isWhitelisted = userEl.dataset.whitelisted === '1';
        var I = window._ctxIcons;

        var items = [
            { icon: I.copy, label: 'Copy ID', action: function() {
                navigator.clipboard.writeText(discordId).then(function() { window._toast('Copied ID!'); });
            }},
            { icon: I.user, label: 'Copy Username', action: function() {
                navigator.clipboard.writeText(username).then(function() { window._toast('Copied username!'); });
            }}
        ];

        // Whitelist toggle (dev owner only, not for dev users themselves)
        if (IS_DEV_OWNER && role !== 'dev') {
            items.push({ divider: true });
            if (isWhitelisted) {
                items.push({
                    icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18"/><path d="M6 6l12 12"/></svg>',
                    label: 'Remove from Whitelist', danger: true,
                    action: function() {
                        window.showConfirm({
                            title: 'Remove from Whitelist',
                            message: 'Remove ' + username + ' from the whitelist? They will lose dev panel access.',
                            confirmText: 'Remove',
                            cancelText: 'Cancel',
                            type: 'danger',
                            onConfirm: function() {
                                fetch('/api/dev/whitelist/remove', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ discordId: discordId })
                                }).then(function(r) { return r.json(); }).then(function(d) {
                                    if (d.success) {
                                        window._toast('Removed from whitelist');
                                        fetchAllUsers();
                                    }
                                });
                            }
                        });
                    }
                });
            } else {
                items.push({
                    icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>',
                    label: 'Add to Whitelist',
                    action: function() {
                        window.showConfirm({
                            title: 'Add to Whitelist',
                            message: username + ' will be able to access the dev panel.',
                            confirmText: 'Add',
                            cancelText: 'Cancel',
                            type: 'success',
                            onConfirm: function() {
                                fetch('/api/dev/whitelist/add', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ discordId: discordId })
                                }).then(function(r) { return r.json(); }).then(function(d) {
                                    if (d.success) {
                                        window._toast('Added to whitelist');
                                        fetchAllUsers();
                                    }
                                });
                            }
                        });
                    }
                });
            }
        }

        // Kick option (dev owner only, for online non-dev users)
        if (IS_DEV_OWNER && isOnline && role !== 'dev') {
            if (!items.some(function(it) { return it.divider; })) items.push({ divider: true });
            items.push({
                icon: I.disconnect, label: 'Kick (Force Logout)', danger: true,
                action: function() {
                    window.showConfirm({
                        title: 'Kick User',
                        message: 'Kick ' + username + ' from the dashboard? They will be logged out.',
                        confirmText: 'Kick',
                        cancelText: 'Cancel',
                        type: 'danger',
                        onConfirm: function() {
                            fetch('/api/dev/kick', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ discordId: discordId })
                            }).then(function(r) { return r.json(); }).then(function(d) {
                                if (d.success) {
                                    window._toast('Kicked ' + username);
                                    fetchAllUsers();
                                } else {
                                    window._toast('Failed: ' + (d.error || 'Unknown error'));
                                }
                            });
                        }
                    });
                }
            });
        }

        window._ctxMenu.open(e, items, {});
    });

    // ─── Login Log ───────────────────────────────────────────────
    var loginLogList = document.getElementById('loginLogList');

    async function fetchLoginLog() {
        try {
            var res = await fetch('/api/dev/login-log');
            if (!res.ok) return;
            var logs = await res.json();
            if (!logs.length) {
                loginLogList.innerHTML = '<div class="empty-state" style="padding:30px;"><p>No login activity recorded yet</p></div>';
                return;
            }
            var html = '';
            logs.forEach(function(log) {
                var date = new Date(log.timestamp);
                var timeStr = date.toLocaleDateString('en-GB') + ' ' + date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
                html += '<div class="login-log-entry">' +
                    '<img src="' + (log.avatarUrl || '') + '" alt="" style="width:28px;height:28px;border-radius:50%;" />' +
                    '<div style="flex:1;">' +
                        '<span style="font-weight:600;">' + escapeHtml(log.globalName || log.username) + '</span>' +
                        '<span class="badge badge-' + log.role + '" style="font-size:0.65rem; padding:1px 6px; margin-left:8px;">' + log.role.toUpperCase() + '</span>' +
                    '</div>' +
                    '<span style="color:var(--text-secondary); font-size:0.8rem;">' + timeStr + '</span>' +
                '</div>';
            });
            loginLogList.innerHTML = html;
        } catch(e) { /* silent */ }
    }

    document.getElementById('refreshLoginLog').addEventListener('click', fetchLoginLog);
    fetchLoginLog();

    // Listen for live login events
    socket.on('dev:login', function(log) {
        fetchLoginLog();
    });

    // ─── Bot Control ─────────────────────────────────────────────
    // Toggle buttons
    document.querySelectorAll('.bot-toggle-btn').forEach(function(btn) {
        btn.addEventListener('click', async function() {
            btn.disabled = true;
            btn.textContent = 'Working...';
            try {
                await fetch('/bots/' + btn.dataset.id + '/toggle', { method: 'POST' });
                location.reload();
            } catch(e) {
                btn.textContent = 'Error';
                setTimeout(function() { location.reload(); }, 1500);
            }
        });
    });

    // Reconnect buttons
    document.querySelectorAll('.bot-reconnect-btn').forEach(function(btn) {
        btn.addEventListener('click', async function() {
            btn.disabled = true;
            btn.textContent = 'Reconnecting...';
            try {
                await fetch('/api/bots/' + btn.dataset.id + '/reconnect', { method: 'POST' });
                window._toast('Reconnect sent for ' + btn.dataset.team);
                btn.textContent = 'Reconnect';
                btn.disabled = false;
            } catch(e) {
                btn.textContent = 'Error';
                setTimeout(function() { btn.textContent = 'Reconnect'; btn.disabled = false; }, 2000);
            }
        });
    });

    // Disconnect buttons
    document.querySelectorAll('.bot-disconnect-btn').forEach(function(btn) {
        btn.addEventListener('click', async function() {
            btn.disabled = true;
            btn.textContent = 'Disconnecting...';
            try {
                await fetch('/api/bots/' + btn.dataset.id + '/disconnect', { method: 'POST' });
                window._toast('Disconnect sent for ' + btn.dataset.team);
                btn.textContent = 'Disconnect';
                btn.disabled = false;
            } catch(e) {
                btn.textContent = 'Error';
                setTimeout(function() { btn.textContent = 'Disconnect'; btn.disabled = false; }, 2000);
            }
        });
    });

    // Live bot status updates
    socket.on('bot:status', function(data) {
        var cards = document.querySelectorAll('[data-team="' + data.teamName + '"]');
        cards.forEach(function(card) {
            var dot = card.querySelector('.status-dot');
            var text = card.querySelector('[id^="statusText-"]');
            if (dot) {
                dot.className = 'status-dot status-' +
                    (data.status === 'connected' || data.status === 'activated' ? 'active' :
                     data.status === 'reconnecting' ? 'warning' : 'inactive');
            }
            if (text) {
                text.textContent = data.status.charAt(0).toUpperCase() + data.status.slice(1);
            }
        });
    });
})();
</script>

<%- include('footer') %>
