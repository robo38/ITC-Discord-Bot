<%- include('layout') %>

<!-- Navbar -->
<nav class="navbar">
    <a href="/" class="navbar-brand">
        <div class="navbar-logo">ITC</div>
        <span>Bot Dashboard</span>
    </a>
    <div class="navbar-right">
        <span class="badge badge-<%= user.role %>"><%= user.role.toUpperCase() %></span>
        <div style="display:flex; align-items:center; gap:8px;">
            <img src="<%= user.avatarUrl %>" alt="" style="width:28px; height:28px; border-radius:50%;" />
            <span style="color: var(--text-secondary); font-size: 0.85rem;"><%= user.globalName || user.username %></span>
        </div>
        <a href="/logout" class="btn btn-outline btn-sm">Logout</a>
    </div>
</nav>

<div class="container">
    <div class="page-header">
        <h1 class="page-title">Add New Bot</h1>
        <a href="/" class="btn btn-outline">‚Üê Back</a>
    </div>

    <% if (error) { %>
        <div class="alert alert-danger"><%= error %></div>
    <% } %>

    <form method="POST" action="/bots/add" id="addBotForm">
        <div class="card" style="max-width:800px;">
            <h2 style="margin-bottom:20px; font-size:1.1rem; color:var(--accent);">Team Information</h2>

            <div class="form-row">
                <div class="form-group">
                    <label>Team Name *</label>
                    <input type="text" name="teamName" placeholder="e.g. Ai, Security, Web Frontend" required />
                </div>
                <div class="form-group">
                    <label>Leader Role ID *</label>
                    <input type="text" name="leaderRoleId" placeholder="Discord role ID for team leaders" required />
                    <div class="form-hint">Anyone with this role will be considered a leader for this team</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Members Role ID *</label>
                    <input type="text" name="membersRoleId" placeholder="Main members role ID" required />
                </div>
                <div class="form-group">
                    <label>Additional Members Role ID (optional)</label>
                    <input type="text" name="additionalMembersRoleId" placeholder="Second role ID if applicable" />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Leader Chat Channel ID *</label>
                    <input type="text" name="leaderChatChannelId" placeholder="Channel for leader reports" required />
                </div>
                <div class="form-group">
                    <label>General Announcement Channel ID *</label>
                    <input type="text" name="generalAnnChannelId" placeholder="Announcement channel ID" required />
                </div>
            </div>
        </div>

        <!-- Split toggle -->
        <div class="card" style="max-width:800px;">
            <h2 style="margin-bottom:20px; font-size:1.1rem; color:var(--accent);">Bot Configuration</h2>

            <div class="form-group">
                <label>Split Mode</label>
                <div class="toggle-wrapper">
                    <label class="toggle">
                        <input type="checkbox" id="splitToggle" name="isSplit" value="true" onchange="toggleSplit()" />
                        <span class="toggle-slider"></span>
                    </label>
                    <span id="splitLabel" style="color:var(--text-secondary);">Single Bot (No Split)</span>
                </div>
                <div class="form-hint">Enable split mode if this team uses 2 bots (Beginner + Advanced)</div>
            </div>

            <!-- Single bot section -->
            <div id="singleBotSection">
                <div class="form-row">
                    <div class="form-group">
                        <label>Bot Token</label>
                        <input type="text" name="botToken" placeholder="Bot token" />
                    </div>
                    <div class="form-group">
                        <label>Bot ID (Client ID)</label>
                        <input type="text" name="botId" placeholder="Application/Client ID" />
                    </div>
                </div>
                <div class="form-group">
                    <label>Voice Channel ID</label>
                    <input type="text" name="voiceChannelId" placeholder="Voice channel the bot joins" />
                </div>
            </div>

            <!-- Split bot section (hidden by default) -->
            <div id="splitBotSection" style="display:none;">
                <div class="split-section">
                    <h3>üü¢ Bot 1 (Beginner)</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Bot Token 1 *</label>
                            <input type="text" name="botToken1" placeholder="Beginner bot token" />
                        </div>
                        <div class="form-group">
                            <label>Voice Channel 1 *</label>
                            <input type="text" name="voiceChannelId1" placeholder="Beginner voice channel ID" />
                        </div>
                    </div>
                </div>

                <div class="split-section" style="margin-top:12px;">
                    <h3>üîµ Bot 2 (Advanced)</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Bot Token 2 *</label>
                            <input type="text" name="botToken2" placeholder="Advanced bot token" />
                        </div>
                        <div class="form-group">
                            <label>Voice Channel 2 *</label>
                            <input type="text" name="voiceChannelId2" placeholder="Advanced voice channel ID" />
                        </div>
                    </div>
                </div>

                <div class="form-group" style="margin-top:16px;">
                    <label>Special Split Role ID (optional)</label>
                    <input type="text" name="specialRoleId" placeholder="Optional role specific to this split" />
                    <div class="form-hint">Leave blank if no special role is needed for the split</div>
                </div>
            </div>
        </div>

        <div style="max-width:800px; display:flex; gap:12px; justify-content:flex-end; margin-top:8px;">
            <a href="/" class="btn btn-outline btn-lg">Cancel</a>
            <button type="submit" class="btn btn-primary btn-lg">Add Bot</button>
        </div>
    </form>
</div>

<script>
function toggleSplit() {
    const isChecked = document.getElementById('splitToggle').checked;
    document.getElementById('singleBotSection').style.display = isChecked ? 'none' : 'block';
    document.getElementById('splitBotSection').style.display = isChecked ? 'block' : 'none';
    document.getElementById('splitLabel').textContent = isChecked ? 'Split Mode (2 Bots)' : 'Single Bot (No Split)';
}
</script>

<%- include('footer') %>
